<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Debug - Lumina Smiles</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .debug-container {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 400px;
            max-height: 500px;
            background: #1a1a1a;
            color: #00ff00;
            border: 2px solid #00ff00;
            border-radius: 8px;
            z-index: 9999;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .debug-header {
            background: #00ff00;
            color: #000;
            padding: 10px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .debug-log {
            padding: 10px;
            max-height: 400px;
            overflow-y: auto;
            background: #000;
        }
        
        .debug-log div {
            margin-bottom: 5px;
            word-wrap: break-word;
        }
        
        .debug-close {
            background: none;
            border: none;
            color: #000;
            cursor: pointer;
            font-size: 16px;
        }
        
        .debug-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            z-index: 10000;
            font-weight: bold;
        }
        
        .form-debug-section {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .form-debug-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <!-- Debug Toggle Button -->
    <button class="debug-toggle" onclick="toggleDebug()">üîß Debug</button>
    
    <!-- Debug Console -->
    <div id="debug-container" class="debug-container" style="display: none;">
        <div class="debug-header">
            <span>üîß Debug Console</span>
            <button class="debug-close" onclick="toggleDebug()">√ó</button>
        </div>
        <div id="debug-log" class="debug-log"></div>
    </div>

    <!-- Main Content -->
    <div style="max-width: 800px; margin: 0 auto; padding: 20px;">
        <h1>üîß Form Debug Test</h1>
        <p>This page includes a debug console to help troubleshoot webhook issues.</p>
        
        <!-- Configuration Test Section -->
        <div class="form-debug-section">
            <h3>üìã Configuration Test</h3>
            <button class="test-button" onclick="testConfig()">Test Configuration</button>
            <button class="test-button" onclick="testWebhookDirect()">Test Webhook Direct</button>
            <div id="config-result"></div>
        </div>
        
        <!-- Form Section -->
        <div class="form-debug-section">
            <h3>üìù Contact Form</h3>
            <form name="contact" data-netlify="true" netlify-honeypot="bot-field">
                <input type="hidden" name="form-name" value="contact">
                <p class="honeypot" style="display: none;">
                    <label>Don't fill this out if you're human: <input name="bot-field"></label>
                </p>
                
                <div class="form-group">
                    <label for="name">Name *</label>
                    <input type="text" id="name" name="name" required>
                </div>
                
                <div class="form-group">
                    <label for="email">Email *</label>
                    <input type="email" id="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label for="phone">Phone *</label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
                
                <div class="form-group">
                    <label for="service">Service *</label>
                    <select id="service" name="service" required>
                        <option value="">Select a service</option>
                        <option value="consultation">Free Consultation</option>
                        <option value="cleaning">Teeth Cleaning</option>
                        <option value="whitening">Teeth Whitening</option>
                        <option value="crowns">Dental Crowns</option>
                        <option value="implants">Dental Implants</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="message">Message</label>
                    <textarea id="message" name="message" rows="4"></textarea>
                </div>
                
                <button type="submit" class="submit-button">Submit Form</button>
            </form>
        </div>
        
        <!-- Manual Test Section -->
        <div class="form-debug-section">
            <h3>üß™ Manual Tests</h3>
            <button class="test-button" onclick="testFormSubmission()">Test Form Submission</button>
            <button class="test-button" onclick="testMakeWebhook()">Test Make Webhook</button>
            <button class="test-button" onclick="clearDebugLog()">Clear Debug Log</button>
        </div>
    </div>

    <!-- Load Configuration -->
    <script src="config.js"></script>
    
    <!-- Load Main Script -->
    <script src="script.js"></script>
    
    <script>
        // Debug toggle function
        function toggleDebug() {
            const container = document.getElementById('debug-container');
            container.style.display = container.style.display === 'none' ? 'block' : 'none';
        }
        
        // Clear debug log
        function clearDebugLog() {
            document.getElementById('debug-log').innerHTML = '';
        }
        
        // Test configuration
        function testConfig() {
            const resultDiv = document.getElementById('config-result');
            resultDiv.innerHTML = '<p>Testing configuration...</p>';
            
            try {
                if (typeof CONFIG === 'undefined') {
                    resultDiv.innerHTML = '<p style="color: red;">‚ùå CONFIG not found</p>';
                    return;
                }
                
                if (!CONFIG.MAKE_WEBHOOK_URL) {
                    resultDiv.innerHTML = '<p style="color: red;">‚ùå Webhook URL not configured</p>';
                    return;
                }
                
                resultDiv.innerHTML = `<p style="color: green;">‚úÖ Configuration OK</p>
                                     <p><strong>Webhook URL:</strong> ${CONFIG.MAKE_WEBHOOK_URL}</p>`;
                
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        // Test webhook directly
        async function testWebhookDirect() {
            const resultDiv = document.getElementById('config-result');
            resultDiv.innerHTML = '<p>Testing webhook directly...</p>';
            
            try {
                const testData = {
                    name: 'Test User',
                    email: 'test@example.com',
                    phone: '+1234567890',
                    service: 'consultation',
                    message: 'Direct webhook test',
                    timestamp: new Date().toISOString(),
                    source: 'debug-test',
                    submissionId: 'direct-test-' + Date.now()
                };
                
                const response = await fetch(CONFIG.MAKE_WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData)
                });
                
                if (response.ok) {
                    resultDiv.innerHTML = '<p style="color: green;">‚úÖ Direct webhook test successful!</p>';
                } else {
                    resultDiv.innerHTML = `<p style="color: red;">‚ùå Direct webhook test failed: ${response.status}</p>`;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<p style="color: red;">‚ùå Direct webhook test error: ${error.message}</p>`;
            }
        }
        
        // Test form submission manually
        function testFormSubmission() {
            const form = document.querySelector('form[name="contact"]');
            if (form) {
                // Fill in test data
                form.querySelector('[name="name"]').value = 'Test User';
                form.querySelector('[name="email"]').value = 'test@example.com';
                form.querySelector('[name="phone"]').value = '+1234567890';
                form.querySelector('[name="service"]').value = 'consultation';
                form.querySelector('[name="message"]').value = 'Manual test submission';
                
                // Trigger submission
                const submitEvent = new Event('submit', { bubbles: true, cancelable: true });
                form.dispatchEvent(submitEvent);
            }
        }
        
        // Test Make webhook function
        async function testMakeWebhook() {
            try {
                const testData = {
                    name: 'Test User',
                    email: 'test@example.com',
                    phone: '+1234567890',
                    service: 'consultation',
                    message: 'Manual webhook test',
                    timestamp: new Date().toISOString(),
                    source: 'manual-test',
                    submissionId: 'manual-test-' + Date.now()
                };
                
                const result = await sendToMakeWebhook(testData);
                
                if (result.success) {
                    alert('‚úÖ Make webhook test successful!');
                } else {
                    alert(`‚ùå Make webhook test failed: ${result.error}`);
                }
                
            } catch (error) {
                alert(`‚ùå Make webhook test error: ${error.message}`);
            }
        }
        
        // Auto-show debug on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('debug-container').style.display = 'block';
            }, 1000);
        });
    </script>
</body>
</html>